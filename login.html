
<!DOCTYPE html>
<html lang="en">
<head><script type="text/javascript" src="/___vscode_livepreview_injected_script"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AdminLTE 3 | Log in</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
  <!-- icheck bootstrap -->
  <link rel="stylesheet" href="../../plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../../dist/css/adminlte.min.css">
</head>
<body class="hold-transition login-page">
<div class="login-box">
  <div class="login-logo">
    <b>AdminLTE</b>
  </div>
  <!-- /.login-logo -->
  <div class="card">
    <div class="card-body login-card-body">
      <p class="login-box-msg">Đăng nhập</p>


      <form id="loginForm">
        <div class="input-group mb-3">
            <input type="text" id="loginUsername" class="form-control" placeholder="Tên người dùng">
            <div class="input-group-append">
                <div class="input-group-text">
                    <span class="fas fa-user"></span>
                </div>
            </div>
        </div>
        <div class="input-group mb-3">
            <input type="password" id="loginPassword" class="form-control" placeholder="Mật khẩu">
            <div class="input-group-append">
                <div class="input-group-text">
                    <span class="fas fa-lock"></span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-5">
                <button type="submit" class="btn btn-primary btn-block">Đăng nhập</button>
            </div>
        </div>
    </form>
    
    <!-- Modal thông báo -->
    <div id="successModal" class="alert alert-success position-fixed" style="display: none; z-index: 1050; top: 20px; right: 20px;">
      Đăng nhập thành công!
    </div>
    
    <div id="errorModal" class="alert alert-danger position-fixed" style="display: none; z-index: 1050; top: 20px; right: 20px;">
      Đăng nhập thất bại! Vui lòng kiểm tra lại.
    </div>
    
    </div>
    <!-- /.login-card-body -->
  </div>
</div>
<!-- /.login-box -->

<script></script>
<!-- jQuery -->
<script src="../../plugins/jquery/jquery.min.js"></script>
<script>
  document.getElementById("loginForm").addEventListener("submit", async function (e) {
      e.preventDefault();
  
      let username = document.getElementById("loginUsername").value.trim();
      let password = document.getElementById("loginPassword").value.trim();
  
      if (!username || !password) {
          alert("Vui lòng nhập đầy đủ tên đăng nhập và mật khẩu.");
          return;
      }
  
      const myHeaders = new Headers();
      myHeaders.append("Content-Type", "application/json");
  
      const raw = JSON.stringify({
          username: username,
          password: password,
      });
  
      const requestOptions = {
          method: "POST",
          headers: myHeaders,
          body: raw,
          redirect: "follow",
      };
  
      try {
          const response = await fetch("http://172.17.161.232:8080/api/user/login", requestOptions);
  
          if (!response.ok) {
              throw new Error("Đăng nhập thất bại. Vui lòng kiểm tra lại thông tin!");
          }
  
          const result = await response.json();
          console.log("Kết quả từ API:", result); // Kiểm tra dữ liệu API trả về
  
          // Lấy token từ result.data.token
          let token = result.data?.token;
          console.log("Token nhận được:", token); 
  
          if (!token) {
              throw new Error("Không tìm thấy token trong phản hồi từ API!");
          }
  
          // Lưu token vào localStorage
          localStorage.setItem("accessToken", token);
          console.log("Token sau khi đăng nhập:", localStorage.getItem("accessToken"));
  
          alert("Đăng nhập thành công!");
          window.location.href = "dashboard.html";
  
      } catch (error) {
          console.error("Lỗi khi đăng nhập:", error);
          alert("Có lỗi xảy ra: " + error.message);
      }
  });
  
  </script>
<!-- Bootstrap 4 -->
<script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="../../dist/js/adminlte.min.js"></script>
</body>
</html>
